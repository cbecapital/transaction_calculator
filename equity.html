<html lang="en"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Transaction Fee Calculator</title> 
  <link rel="stylesheet" href="equity.css">
</head> 
<body>     

<video autoplay muted loop id="bg-video">
  <source src="cbe-logo-2.mp4" type="video/mp4">
</video>

    <button class="home-btn" onclick="location.href='index.html'">Home</button>

<div class="container"> 
<div class="ticker">
  <div class="ticker-content">
    <span>WGBX:ETB 1200 </span>
    <span>GDAB: ETB 1057 | Qty=5</span>
    <span>TBL182D:ETB  4700 | Qty=0</span>
    <span>IBMM:ETB  15.3973% </span>


    <!-- duplicate for smooth infinite loop -->
     <span>WGBX:ETB  1200 | Qty=50</span>
    <span>GDAB:ETB 1057 | Qty=5</span>
    <span>TBL182D:ETB 4700 | Qty=0</span>
    <span>IBMM:ETB 15.3973% </span>
  </div>
</div>
<script>
/* ===============================
   INTEGER INPUT (Quantity)
   =============================== */
function formatIntegerWithCommas(input) {
  let raw = input.value.replace(/,/g, "");
  raw = raw.replace(/\D/g, "");

  if (raw === "") {
    input.value = "";
    return;
  }

  input.value = Number(raw).toLocaleString("en-US");
}

/* ===============================
   DECIMAL INPUT (Price / ETB)
   =============================== */
function formatDecimalWithCommas(input) {
  let raw = input.value.replace(/,/g, "");
  raw = raw.replace(/[^0-9.]/g, "");

  const parts = raw.split(".");
  if (parts.length > 2) {
    raw = parts[0] + "." + parts[1];
  }

  let intPart = parts[0] || "";
  let decPart = parts[1] || "";

  decPart = decPart.substring(0, 2);

  if (intPart === "" && decPart === "") {
    input.value = "";
    return;
  }

  let formattedInt = intPart
    ? Number(intPart).toLocaleString("en-US")
    : "";

  input.value =
    decPart !== ""
      ? formattedInt + "." + decPart
      : formattedInt;
}

/* ===============================
   OUTPUT FORMATTER (ETB)
   =============================== */
function formatETB(value) {
  return Number(value).toLocaleString("en-US", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}
</script>


<script>
function formatNumberInput(input) {
  let value = input.value.replace(/,/g, ""); // remove existing commas
  if (!isNaN(value) && value !== "") {
    input.value = Number(value).toLocaleString("en-US");
  }
}
</script>



  <h1>Transaction Fee Calculator For Equity Main & Growth Market</h1>

  <div class="button-row">
    <button class="btn" onclick="showSection('buySection')">Buy</button>
    <button class="btn" onclick="showSection('sellSection')">Sell</button>
  </div>



  <!-- BUY SECTION -->
  <div id="buySection" style="display:none; margin-top:20px;">
  <h2>Buy Transaction</h2>

  <label for="buyQuantity">Enter Quantity (number of share):</label>
<input type="text" id="buyMarketPrice" placeholder="1000.00"
       oninput="formatDecimalWithCommas(this)">


  <label for="buyMarketPrice">Price (per share):</label>
  <input type="text" id="buyMarketPrice" placeholder="e.g. 120.50"
         oninput="formatDecimalWithCommas(this)">

  <button onclick="calculateFee('buy')">Calculate Buy</button>
  <div id="buyResult"></div>

  <!-- INVESTMENT SECTION -->
  <div id="investmentSection" style="margin-top:20px;">
    <h2>Investment Calculator</h2>

    <label for="investmentAmount">Enter Anticipated Investment Amount (ETB):</label>
    <input type="text" id="investmentAmount" placeholder="e.g. 30,000.00"
           oninput="formatDecimalWithCommas(this)">

    <label for="sharePrice">Enter Price (per share):</label>
    <input type="text" id="sharePrice" placeholder="e.g. 1,200.00"
           oninput="formatDecimalWithCommas(this)">

    <button onclick="calculateShares()">Calculate Share amount</button>
    <div id="investmentResult"></div>
  </div>
</div>

<script>
/* ---------- INTEGER (Quantity) ---------- */
function formatIntegerWithCommas(input) {
  let val = input.value.replace(/,/g, "");
  val = val.replace(/\D/g, ""); // numbers only
  if (val !== "") {
    input.value = Number(val).toLocaleString("en-US");
  } else {
    input.value = "";
  }
}

/* ---------- DECIMAL (Money / Price) ---------- */
function formatDecimalWithCommas(input) {
  let val = input.value.replace(/,/g, "");
  val = val.replace(/[^0-9.]/g, "");

  const parts = val.split(".");
  if (parts.length > 2) {
    val = parts[0] + "." + parts[1];
  }

  if (parts[1]) {
    parts[1] = parts[1].substring(0, 2); // max 2 decimals
    val = parts[0] + "." + parts[1];
  }

  if (val !== "" && !isNaN(val)) {
    input.value = Number(val).toLocaleString("en-US", {
      minimumFractionDigits: parts[1] ? parts[1].length : 0,
      maximumFractionDigits: 2
    });
  }
}
</script>


  <!-- SELL SECTION -->
  <div id="sellSection" style="display:none; margin-top:20px;">
    <h2>Sell Transaction</h2>
    <label for="sellQuantity">Enter Quantity (number of Share):</label>
<input type="text" id="sellQuantity" placeholder="e.g. 100" 
       oninput="formatNumberInput(this)">

    <label for="sellMarketPrice">Enter Price (per share):</label>
<input type="text" id="sellMarketPrice" placeholder="e.g. 120.50" 
       oninput="formatDecimalWithCommas(this)">

       
    <button onclick="calculateFee('sell')">Calculate Sell</button>
    <div id="sellResult"></div>
  </div>

  <script>
    function showSection(sectionId) {
      document.getElementById("buySection").style.display = "none";
      document.getElementById("sellSection").style.display = "none";
      document.getElementById(sectionId).style.display = "block";
    }

const RATE = 0.0211;

function calculateFee(type) {
  const qtyId = type === "buy" ? "buyQuantity" : "sellQuantity";
  const priceId = type === "buy" ? "buyMarketPrice" : "sellMarketPrice";
  const resultId = type === "buy" ? "buyResult" : "sellResult";

  const rawQty = document.getElementById(qtyId).value.replace(/,/g, "");
  const rawPrice = document.getElementById(priceId).value.replace(/,/g, "");

  const quantity = parseFloat(rawQty);
  const marketPrice = parseFloat(rawPrice);

  if (isNaN(quantity) || quantity <= 0) {
    alert("Please enter a valid quantity (greater than 0).");
    return;
  }
  if (isNaN(marketPrice) || marketPrice <= 0) {
    alert("Please enter a valid market/limit price (greater than 0).");
    return;
  }

  const tradeValue = quantity * marketPrice;

  // fees
  const feeCBE = tradeValue * 0.016;   // 1.6%
  const feeECMA = tradeValue * 0.0015; // 0.15%
  const feeESX = tradeValue * 0.0036;  // 0.36%
  const csdFee = 0;                    // 0%

  const fee2nd = feeECMA + feeESX + csdFee;
  const fee = feeCBE + feeECMA + feeESX + csdFee;
let total;
if (type === "buy") {
  total = tradeValue + fee; // buy keeps original calculation
} else {
  total = (tradeValue - fee) // sell subtracts fee and applies multiplier
}


  const resultDiv = document.getElementById(resultId);
  resultDiv.style.display = "block";

  
  resultDiv.innerHTML = `
    <table class="result-table">
      
       <tbody>
        <tr><td>Quantity</td><td>${quantity.toLocaleString("en-US")}</td></tr>
        <tr><td>Price (per share)</td><td>${marketPrice.toLocaleString("en-US")} ETB</td></tr>
        <tr><td>Transaction Value</td><td>${formatETB(tradeValue)} ETB</td></tr>
      </tbody>
      <table class="result-table">
     
      <!-- CBE CAPITAL separate table -->
<table class="result-table">
  <thead>
    <tr>
      <th></th>
      <th>Commission </th>
      <th>Amount (ETB)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CBE CAPITAL</td>
      <td>1.6%</td>
      <td>${feeCBE.toLocaleString("en-US")}</td>
    </tr>
  </tbody>
</table>

<br>

<!-- Other fees table -->
<table class="result-table">
  <thead>
    <tr>
      <th></th>
      <th> Fee</th>
      <th>Amount (ETB)</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>ECMA</td><td>0.15%</td><td>${feeECMA.toLocaleString("en-US")}</td></tr>
    <tr><td>ESX</td><td>0.36%</td><td>${feeESX.toLocaleString("en-US")}</td></tr>
    <tr><td>CSD</td><td>0.00%</td><td>${csdFee.toFixed(2)}</td></tr>
    
    <tr>
      <td><strong>ðŸ“Š Total Fees </strong></td>
      <td><strong>0.51%</strong></td>
      <td><strong>${fee2nd.toLocaleString("en-US")}</strong></td>
    </tr>


    <tr>
      <td><strong>ðŸ“Š Total Commission + Fees </strong></td>
      <td><strong>${(RATE*100).toFixed(2)}% </strong></td>
      <td><strong>${fee.toLocaleString("en-US")}</strong></td>
    </tr>
  </tbody>
</table>

    <br>

    <table class="result-table">
      <tbody>
        <table class="result-table">
  <tbody>
    <tr>
      <td>ðŸ“¦ ${type === "buy" ? "Total Amount Due" : "Net Proceeds"}</td>
      <td><strong>${total.toLocaleString("en-US")} ETB</strong></td>
    </tr>
  </tbody>
</table>

      </tbody>
    </table>
  `;
}
function calculateShares() {
  // read & validate
  const rawAmount = document.getElementById("investmentAmount").value.replace(/,/g, "");
  const rawPrice  = document.getElementById("sharePrice").value.replace(/,/g, "");

  const amount = parseFloat(rawAmount);
  const price  = parseFloat(rawPrice);

  if (isNaN(amount) || amount <= 0) {
    alert("Please enter a valid investment amount.");
    return;
  }
  if (isNaN(price) || price <= 0) {
    alert("Please enter a valid market price per share.");
    return;
  }

  // --- integer cents for exactness ---
  const amountCents = Math.round(amount * 100); // amount in ETB-cents
  const priceCents  = Math.round(price  * 100); // price in ETB-cents

 
  const TOTAL_RATE_NUM = 211;
  const TOTAL_RATE_DEN = 10000;

  
  const costPerShareWithFeesCents = Math.ceil(priceCents * (TOTAL_RATE_DEN + TOTAL_RATE_NUM) / TOTAL_RATE_DEN);

  
  let quantity = Math.floor(amountCents / costPerShareWithFeesCents);

  let tradeValueCents = 0;
  let feeCBEc = 0, feeECMAc = 0, feeESXc = 0, feeTotalC = 0, totalCostCents = 0;

  while (quantity > 0) {
    tradeValueCents = quantity * priceCents;

    // compute each fee in cents (round to nearest cent)
    feeCBEc  = Math.round(tradeValueCents * 16  / 1000);   // 1.6%
    feeECMAc = Math.round(tradeValueCents * 15  / 10000);  // 0.15%
    feeESXc  = Math.round(tradeValueCents * 36  / 10000);  // 0.36%

    fee2nd =  feeECMAc + feeESXc;

    feeTotalC = feeCBEc + feeECMAc + feeESXc;
    totalCostCents = tradeValueCents + feeTotalC;

    // if this total fits in investor's cash, we are done
    if (totalCostCents <= amountCents) break;

    // else reduce one share and try again
    quantity--;
  }

  const resultDiv = document.getElementById("investmentResult");
  resultDiv.style.display = "block";

  // helper to format cents -> "1,234.56"
  const fmt = (cents) => (cents / 100).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  if (quantity === 0) {
    // can't buy even one share after fees
    const minNeededCents = costPerShareWithFeesCents;
    resultDiv.innerHTML = `
      <h4>Investment Result</h4>
      <p><strong>Insufficient funds to buy 1 share after transaction fees.</strong></p>
      <table class="result-table">
        <tr><td>Your Cash</td><td>${fmt(amountCents)} ETB</td></tr>
        <tr><td>Cost to buy 1 share (price + fees)</td><td>${fmt(minNeededCents)} ETB</td></tr>
        <tr><td>Required Extra</td><td>${fmt(Math.max(0, minNeededCents - amountCents))} ETB</td></tr>
      </table>
      <p style="font-size:0.9em; color:#fff">Fees used: CBE 1.60%, ECMA 0.15%, ESX 0.36% (total 2.11%).</p>
    `;
    return;
  }

  const leftoverCents = amountCents - totalCostCents;

  // show detailed breakdown
  resultDiv.innerHTML = `

<!-- Table 1: Input Summary -->
<table class="result-table">
  <tr><td> Anticipated Investment Amount</td><td>${fmt(amountCents)} ETB</td></tr>
  <tr><td> Price </td><td>${fmt(priceCents)} ETB</td></tr>
  <tr><td>Shares you can buy</td><td>${quantity.toLocaleString("en-US")}</td></tr>
  <tr><td>Trade value (shares Ã— price)</td><td>${fmt(tradeValueCents)} ETB</td></tr>
</table>

<br>

<!-- Table 2: Fees -->
<table class="result-table">
  <thead>
    <tr>
      <th></th>
      <th> commision </th>
      <th>Amount (ETB)</th>
    </tr>
  </thead>

  <tr> <td>CBE fee </td>  <td> (1.6%)</td>
    
  <td>${fmt(feeCBEc)} ETB</td></tr>
  
  <thead>
    <tr>
      <th></th>
      <th> Fee</th>
      <th>Amount (ETB)</th>
    </tr>
  </thead>
  <tr><td>ECMA fee </td> <td> (0.15%)</td><td>${fmt(feeECMAc)} ETB</td></tr>
  <tr><td>ESX fee </td> <td>(0.36%)</td><td>${fmt(feeESXc)} ETB</td></tr>
   
  <tr>
      <td><strong>ðŸ“Š Total Fees </strong></td>
      <td><strong>0.51%</strong></td>
      <td><strong>${fee2nd.toLocaleString("en-US")}</strong></td>
    </tr>

  <tr><td><strong>Total Commision + fees </td> <td> (2.11%)</strong></td><td><strong>${fmt(feeTotalC)} ETB</strong></td></tr>
</table>

<br>

<!-- Table 3: Final Outcome -->

<table class="result-table">
   <thead>
    <tr>
      <th>    Summary </th>
    </tr>
  </thead>
  <tr><td><strong>Total cost (trade value + fees)</strong></td><td><strong>${fmt(totalCostCents)} ETB</strong></td></tr>
    <tr><td>Shares you can buy</td><td>${quantity.toLocaleString("en-US")}</td></tr>
  <tr><td>Remaining Cash</td><td>${fmt(leftoverCents)} ETB</td></tr>
</table>

    <p style="font-size:0.9em; color:#fff">Calculation notes: fee amounts are rounded to the nearest cent; we used exact integer-cent math and adjusted quantity so <strong>total cost &le; your cash</strong>.</p>
  `;
}

  </script>
</body>
</html>